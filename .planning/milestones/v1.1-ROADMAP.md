# Milestone v1.1: Test Web App

**Status:** SHIPPED 2026-02-08
**Phases:** 9-15
**Total Plans:** 14

## Overview

Comprehensive automated test suite with CI pipeline covering all application layers -- unit/integration (pytest) + E2E (Playwright) for scoring, deduplication, dashboard, platform scrapers (mocked), and apply flow. 80%+ coverage target, CI-ready on GitHub Actions.

## Phases

### Phase 9: Test Infrastructure

**Goal**: Every test module can run in complete isolation without touching production data, real APIs, or leaking state between tests
**Depends on**: Phase 8 (v1.0 complete)
**Plans**: 2 plans

Plans:

- [x] 09-01-PLAN.md -- Dependencies, pytest/coverage config, test directory structure, test config YAML
- [x] 09-02-PLAN.md -- Root conftest with isolation fixtures, factories, sub-directory conftest files, smoke tests

**Details:**
- Requirements: INFRA-01, INFRA-02, INFRA-03, INFRA-04, INFRA-05, INFRA-06
- Success Criteria: pytest discovers tests with correct config, settings isolation, in-memory SQLite, Anthropic API guard, factory-boy job factories
- Key artifacts: pyproject.toml pytest config, tests/conftest.py (3 autouse fixtures), tests/conftest_factories.py (JobFactory), tests/fixtures/test_config.yaml, sub-directory conftest files

### Phase 10: Unit Tests

**Goal**: All pure logic modules (models, scoring, salary, dedup, anti-fabrication, delta detection) have passing tests that verify correctness without any I/O
**Depends on**: Phase 9
**Plans**: 3 plans

Plans:

- [x] 10-01-PLAN.md -- Pydantic model validation (UNIT-01) and salary normalization (UNIT-02)
- [x] 10-02-PLAN.md -- Job scoring correctness and score breakdown (UNIT-03, UNIT-04)
- [x] 10-03-PLAN.md -- Deduplication (UNIT-05, UNIT-06), anti-fabrication (UNIT-07), delta detection (UNIT-08)

**Details:**
- Requirements: UNIT-01 through UNIT-08
- 204 tests total: test_models.py (54), test_salary.py (31), test_scorer.py (52), test_dedup.py (33), test_validator.py (23), test_delta.py (11)
- Coverage: models.py 100%, salary.py 100%, scorer.py 92%, dedup.py 96%, validator.py 98%

### Phase 11: Database Integration Tests

**Goal**: All database operations (CRUD lifecycle, FTS5 search, activity log, bulk updates, schema initialization) work correctly against an in-memory SQLite instance
**Depends on**: Phase 9
**Plans**: 2 plans

Plans:

- [x] 11-01-PLAN.md -- CRUD lifecycle, bulk operations, stats, run history, backfill, and schema initialization (DB-01, DB-04, DB-05)
- [x] 11-02-PLAN.md -- FTS5 full-text search and activity log recording (DB-02, DB-03)

**Details:**
- Requirements: DB-01 through DB-05
- 68 tests in tests/webapp/test_db.py, 91% webapp/db.py coverage
- Production bug fix: ORDER BY tiebreaker for same-second events in get_activity_log()

### Phase 12: Web & API Integration Tests

**Goal**: All FastAPI endpoints return correct responses, and platform integration code (RemoteOK parsing, platform registry) works correctly with mocked external dependencies
**Depends on**: Phase 9, Phase 11
**Plans**: 3 plans

Plans:

- [x] 12-01-PLAN.md -- Dashboard, detail, status/notes, and search endpoint tests (WEB-01, WEB-02, WEB-03, WEB-08)
- [x] 12-02-PLAN.md -- CSV/JSON export, bulk status, and import endpoint tests (WEB-04, WEB-05, WEB-06, WEB-07)
- [x] 12-03-PLAN.md -- RemoteOK parsing/error handling and platform registry/protocol tests (API-01, API-02, API-03, API-04)

**Details:**
- Requirements: WEB-01 through WEB-08, API-01 through API-04
- 98 tests total: test_endpoints.py (56), test_remoteok.py (22), test_registry.py (20)
- Production bug fixes: check_same_thread=False for TestClient, Python 3.14 inspect.signature() with Format.FORWARDREF

### Phase 13: Config Integration Tests

**Goal**: YAML configuration loading, validation, defaults, and environment variable overrides all work correctly
**Depends on**: Phase 9
**Plans**: 1 plan

Plans:

- [x] 13-01-PLAN.md -- YAML loading, validation, defaults, and env var override tests (CFG-01, CFG-02, CFG-03, CFG-04)

**Details:**
- Requirements: CFG-01 through CFG-04
- 34 tests in tests/test_config.py across 4 test classes
- Key pattern: config_from_yaml fixture with temp YAML + /dev/null env_file isolation

### Phase 14: CI Pipeline

**Goal**: All tests run automatically on every push and PR via GitHub Actions, with coverage enforcement and fast feedback
**Depends on**: Phase 10, Phase 11, Phase 12, Phase 13
**Plans**: 1 plan

Plans:

- [x] 14-01-PLAN.md -- GitHub Actions CI workflow (test-lint + e2e jobs) and coverage threshold (CI-01, CI-02, CI-03, CI-04, CI-05)

**Details:**
- Requirements: CI-01 through CI-05
- .github/workflows/ci.yml with test-lint (pytest --cov + ruff) and e2e (Playwright, non-blocking) jobs
- Coverage threshold: fail_under=80 in pyproject.toml (single source of truth)
- astral-sh/setup-uv@v7 replaces setup-python + actions/cache

### Phase 15: E2E Tests

**Goal**: Critical dashboard user flows are verified end-to-end in a real browser, confirming that the full stack (FastAPI + SQLite + Jinja2 + htmx + JS) works together
**Depends on**: Phase 11, Phase 12
**Plans**: 2 plans

Plans:

- [x] 15-01-PLAN.md -- E2E infrastructure (pytest-playwright, live server fixture, seeded DB) + dashboard load, filtering, and status change tests (E2E-01, E2E-02, E2E-03)
- [x] 15-02-PLAN.md -- Kanban drag-and-drop, CSV/JSON export download tests, and CI E2E command fix (E2E-04, E2E-05)

**Details:**
- Requirements: E2E-01 through E2E-05
- 11 E2E tests across 4 files: test_dashboard.py (4), test_status.py (2), test_kanban.py (2), test_export.py (3)
- Live server fixture: uvicorn on port 8765 in daemon thread (session-scoped)
- htmx.ajax fallback for SortableJS drag-and-drop testing

---

## Milestone Summary

**Key Decisions:**

- Strict asyncio mode (force explicit @pytest.mark.asyncio on async tests)
- No Playwright mocking for scraper tests -- extract pure parsing functions instead
- E2E tests CI-optional (separate job, not blocking)
- JOBFLOW_TEST_DB=1 env var for in-memory SQLite (set before imports)
- Coverage threshold in pyproject.toml, not CLI flag (single source of truth)
- Factory-boy Meta.model=Job for automatic Pydantic validation
- config_from_yaml fixture with /dev/null env_file for full config isolation
- htmx.ajax fallback for SortableJS drag-and-drop (forceFallback makes native drag_to unreliable)

**Issues Resolved:**

- get_activity_log() ORDER BY tiebreaker for same-second events (Phase 11)
- _parse_score parameter type mismatch in 5 filter endpoints (Phase 15)
- Python 3.14 inspect.signature() with TYPE_CHECKING annotations (Phase 12)
- except clause Python 2 comma syntax in registry.py (Phase 12)
- CI E2E command needed -p no:socket to disable pytest-socket plugin (Phase 15)

**Issues Deferred:**

- 4 analytics routes untested (/runs, /analytics, /api/analytics, /api/stats-cards)
- 8 resume AI and apply engine routes untested (out of v1.1 scope)
- SSE endpoint testing (TestClient + EventSourceResponse interaction)

**Technical Debt Incurred:**

- scorer.py score_batch_with_breakdown uncovered (8 lines, 92% coverage)
- 26 DeprecationWarning for Starlette TemplateResponse signature (upstream fix pending)
- CI workflow not yet validated on GitHub (local verification only)
- Playwright browsers not cached in CI (restore time equals download time per docs)

---

_For current project status, see .planning/ROADMAP.md_
