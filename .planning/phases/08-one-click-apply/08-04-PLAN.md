---
phase: 08-one-click-apply
plan: 04
type: execute
wave: 4
depends_on: ["08-01", "08-02", "08-03"]
files_modified:
  - apply_engine/__init__.py
autonomous: false

must_haves:
  truths:
    - "User verifies that the Apply section appears on the job detail page with mode dropdown"
    - "User verifies that clicking Apply Now shows real-time progress updates via SSE"
    - "User verifies that duplicate detection warns before re-applying to an already-applied job"
    - "User verifies that the Confirm/Cancel buttons work during semi-auto mode"
    - "User verifies that apply events appear in the job activity timeline"
  artifacts: []
  key_links: []
---

<objective>
Verify the full one-click apply flow end-to-end from the dashboard. Start the web server, navigate to a job detail page, test mode selection, duplicate detection warning, and the SSE streaming connection.

Purpose: Human verification of the complete apply flow before marking Phase 8 as complete.
Output: Verified apply flow working from dashboard.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-one-click-apply/08-01-SUMMARY.md
@.planning/phases/08-one-click-apply/08-02-SUMMARY.md
@.planning/phases/08-one-click-apply/08-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Smoke test all apply components import and wire correctly</name>
  <files>apply_engine/__init__.py</files>
  <action>
Run a comprehensive smoke test to verify all components work together:

1. Verify all imports work:
```python
from apply_engine import ApplyMode, ApplyConfig, ApplyEvent, ApplyEventType, is_already_applied
from apply_engine.engine import ApplyEngine
from apply_engine.dedup import is_already_applied
from apply_engine.config import ApplyConfig, ApplyMode
from apply_engine.events import ApplyEvent, ApplyEventType, make_progress_event, make_done_event
```

2. Verify config integration:
```python
from config import get_settings
s = get_settings()
assert hasattr(s, 'apply')
assert s.apply.default_mode == ApplyMode.SEMI_AUTO
```

3. Verify engine can be instantiated:
```python
engine = ApplyEngine()
assert hasattr(engine, 'apply')
assert hasattr(engine, 'confirm')
assert hasattr(engine, 'cancel')
```

4. Verify webapp loads without errors:
```python
from webapp.app import app
```

5. Verify SSE dependency:
```python
from sse_starlette import EventSourceResponse
```

6. Verify templates exist and render:
```python
from jinja2 import Environment, FileSystemLoader
env = Environment(loader=FileSystemLoader('webapp/templates'))
env.get_template('partials/apply_status.html')
```

7. Verify duplicate detection query works:
```python
result = is_already_applied('nonexistent_key')
assert result is None
```

If any verification fails, fix the issue. This may require small adjustments to imports or __init__.py exports.

Also update `apply_engine/__init__.py` if any exports are missing based on what the other plans created.
  </action>
  <verify>
Run the full smoke test script as a single Python command. All assertions pass, no import errors.
  </verify>
  <done>
All apply components import correctly, config integration works, engine instantiates, webapp loads, SSE dependency available, templates render, duplicate detection queries the database.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete one-click apply system: apply mode configuration (semi-auto/full-auto/easy-apply-only), apply engine with thread bridge and event emission, SSE streaming from FastAPI to htmx, duplicate detection, enhanced form filler with iframe detection, and dashboard UI with mode selector, Apply Now button, and real-time status updates.
  </what-built>
  <how-to-verify>
1. Start the dashboard: `python -m webapp.app`
2. Open http://127.0.0.1:8000
3. Click on any job to open the detail page
4. Verify the "Apply" section appears in the sidebar with:
   - A mode dropdown (Semi-Auto, Full Auto, Easy Apply Only)
   - An "Apply Now" button (purple)
   - Info text about the apply type (Easy Apply vs External)
5. If the job is already in "applied" status, verify the button shows "Already Applied" and is disabled
6. Change the mode dropdown and verify it responds
7. (Optional) Click "Apply Now" on a test job to verify SSE streaming starts -- you should see a connecting message, then progress updates. You can cancel if you don't want to actually apply.
8. Check that the config.yaml has an `apply:` section with all expected fields
9. Verify `python -c "from config import get_settings; print(get_settings().apply.default_mode)"` prints "semi_auto"
10. Verify apply events appear in the job's activity timeline (scroll down to the Activity Log section on the job detail page after triggering an apply)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. All smoke tests pass
2. Dashboard loads and shows Apply section on job detail pages
3. Apply mode dropdown works
4. SSE connection establishes when Apply is clicked
5. Duplicate detection shows warning for already-applied jobs
6. Apply events appear in job activity timeline
</verification>

<success_criteria>
- Human verified: Apply section visible on job detail page
- Human verified: Mode selector works
- Human verified: Apply button triggers the engine (SSE connection visible)
- Human verified: Already-applied jobs show disabled button
- Human verified: Apply events appear in activity timeline
- All smoke tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-one-click-apply/08-04-SUMMARY.md`
</output>
