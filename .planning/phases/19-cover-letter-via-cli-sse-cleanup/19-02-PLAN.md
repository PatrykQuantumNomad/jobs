---
phase: 19-cover-letter-via-cli-sse-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/CLAUDE.md
  - docs/architecture.md
  - .planning/codebase/INTEGRATIONS.md
  - .planning/PROJECT.md
autonomous: true

must_haves:
  truths:
    - "CLAUDE.md stack description says 'Claude CLI' not 'Anthropic SDK'"
    - "docs/architecture.md no longer references ANTHROPIC_API_KEY or 'Anthropic SDK' in current-state descriptions"
    - "INTEGRATIONS.md AI/ML section describes Claude CLI subprocess, not anthropic SDK client"
    - "INTEGRATIONS.md required env vars do not include ANTHROPIC_API_KEY"
    - "PROJECT.md tech stack says 'Claude CLI' not 'Anthropic SDK (Claude)'"
    - "No production Python file imports the anthropic package (verified via grep)"
    - "Historical planning docs (phases 1-18) are NOT modified"
    - "config.yaml tech_keywords 'anthropic' is NOT removed (it is a legitimate technology name)"
  artifacts:
    - path: ".claude/CLAUDE.md"
      provides: "Updated stack description with Claude CLI"
      contains: "Claude CLI"
    - path: "docs/architecture.md"
      provides: "Updated AI integration description without ANTHROPIC_API_KEY references"
    - path: ".planning/codebase/INTEGRATIONS.md"
      provides: "Updated AI/ML section describing Claude CLI subprocess"
    - path: ".planning/PROJECT.md"
      provides: "Updated tech stack listing"
  key_links:
    - from: ".claude/CLAUDE.md"
      to: "claude_cli/"
      via: "Stack description references Claude CLI as AI dependency"
      pattern: "Claude CLI"
    - from: ".planning/codebase/INTEGRATIONS.md"
      to: "claude_cli/client.py"
      via: "AI/ML section describes subprocess wrapper"
      pattern: "claude_cli"
---

<objective>
Update all current-state documentation to reflect the Claude CLI prerequisite replacing the Anthropic SDK, and verify the SDK is fully removed from runtime dependencies.

Purpose: After Phase 16 replaced the Anthropic SDK with Claude CLI subprocess calls, several documentation files still reference the old SDK. This plan systematically updates all stale references so new contributors get accurate setup instructions. This completes requirement CFG-02.

Output: Updated CLAUDE.md, docs/architecture.md, INTEGRATIONS.md, and PROJECT.md with accurate CLI references. Verification that no production code imports anthropic.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-cover-letter-via-cli-sse-cleanup/19-RESEARCH.md
@.claude/CLAUDE.md
@docs/architecture.md
@.planning/codebase/INTEGRATIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update documentation files to reference Claude CLI</name>
  <files>.claude/CLAUDE.md, docs/architecture.md, .planning/codebase/INTEGRATIONS.md, .planning/PROJECT.md</files>
  <action>
  Update all current-state documentation files to replace Anthropic SDK references with Claude CLI. Use the exact file list from the research document. Do NOT modify historical planning docs (phases 1-18), and do NOT remove "anthropic" from config.yaml tech_keywords (it is a legitimate technology name for job matching).

  **In `.claude/CLAUDE.md`:**

  1. Line 5 -- Stack description: Change `Anthropic SDK` to `Claude CLI (subprocess)`. The full line should read:
     `**Stack:** Python 3.14, Playwright + playwright-stealth, FastAPI + Jinja2 + htmx, SQLite (FTS5), Pydantic v2 + pydantic-settings (YAML), Claude CLI (subprocess), WeasyPrint, SSE via sse-starlette.`

  2. Line 36 (in `resume_ai/` description) -- Change `Anthropic structured outputs for resume tailoring` to `Claude CLI structured outputs for resume tailoring`

  **In `docs/architecture.md`:**

  1. Line 5 (executive summary) -- Change `AI integration via Anthropic's Claude API handles resume tailoring and cover letter generation` to `AI integration via Claude CLI subprocess handles resume tailoring and cover letter generation`

  2. Line 28 -- Change `the dashboard works without ANTHROPIC_API_KEY` to `the dashboard works without Claude CLI installed`

  3. Line 58 -- Change `AI modules use **lazy imports** from app.py to avoid loading Anthropic SDK at startup` to `AI modules use **lazy imports** from app.py to avoid loading AI dependencies at startup`

  4. Line 175 -- Change `Uses Anthropic's messages.parse() for structured output (not JSON mode) -- Pydantic models define the schema` to `Uses Claude CLI subprocess with --json-schema for structured output -- Pydantic models define the schema`

  5. Line 193 -- Change `ANTHROPIC_API_KEY loaded via env. Lazy-imported -- dashboard works without it. No rate limiting or cost tracking.` to `Claude CLI invoked via subprocess. Lazy-imported -- dashboard works without it installed. Runs on user's Anthropic subscription (no separate API key needed).`

  6. Line 228 (Recommendation 5, "Add AI cost tracking") -- Change `The Anthropic API calls in resume_ai/tailor.py and resume_ai/cover_letter.py have no token counting or cost estimation. Since each tailored resume costs ~$0.01-0.10, adding response.usage.input_tokens / output_tokens logging to the resume_versions table would provide visibility into AI spend per job application.` to `The Claude CLI subprocess calls in resume_ai/tailor.py and resume_ai/cover_letter.py run on the user's Anthropic subscription (no per-token API billing). Cost tracking is handled at the subscription level.`

  **In `.planning/codebase/INTEGRATIONS.md`:**

  1. Lines 24-30 (AI/ML section) -- Replace the entire Anthropic Claude block with:
     ```
     - Anthropic Claude - Resume tailoring and cover letter generation via CLI subprocess
       - Client: `claude_cli/` package (asyncio.create_subprocess_exec)
       - Auth: Claude CLI authenticated via user's Anthropic subscription (no API key needed)
       - Model: `sonnet` (CLI alias, resolves to latest Claude Sonnet)
       - Usage: `resume_ai/tailor.py`, `resume_ai/cover_letter.py`, `ai_scorer.py`
       - API: `claude_cli.run()` with `--json-schema` for structured output
     ```

  2. Line 96 (Required env vars) -- Remove the `ANTHROPIC_API_KEY` line entirely. The remaining required env vars are the platform credentials and candidate profile fields.

  **In `.planning/PROJECT.md`:**

  1. Line 98 (tech stack) -- Change `Anthropic SDK (Claude)` to `Claude CLI (subprocess)`. The full line context is in the "Context" section describing the tech stack.

  **Verification step (do this last):**

  Run a case-insensitive grep for "anthropic" across all non-planning, non-historical files to verify no stale references remain. Expected results:
  - `config.yaml` -- "anthropic" in tech_keywords (KEEP, legitimate technology name)
  - `pyproject.toml` -- "anthropic" may appear only in project metadata/description, NOT in dependencies
  - Historical planning docs (phases 1-18) -- acceptable, do not modify
  - Test files -- `mock_claude_cli` fixture references are fine (they mock the CLI, not the SDK)
  - NO results in production Python code importing `anthropic`
  </action>
  <verify>
  1. Grep for `Anthropic SDK` (case-sensitive) in `.claude/CLAUDE.md`, `docs/architecture.md`, `.planning/codebase/INTEGRATIONS.md`, `.planning/PROJECT.md` -- should return ZERO results
  2. Grep for `ANTHROPIC_API_KEY` in the same files -- should return ZERO results
  3. Grep for `Claude CLI` in `.claude/CLAUDE.md` -- should return at least 1 result
  4. Grep for `Claude CLI` in `docs/architecture.md` -- should return at least 1 result
  5. Grep for `claude_cli` in `.planning/codebase/INTEGRATIONS.md` -- should return at least 1 result
  6. Grep case-insensitive for `import anthropic` across all `.py` files -- should return ZERO results in production code
  7. `uv run ruff check .` -- no lint errors (documentation changes should not affect Python linting, but verify)
  8. `uv run pytest tests/ -x --timeout=30` -- full suite still passes (documentation-only changes)
  </verify>
  <done>
  All 4 documentation files updated with Claude CLI references. ANTHROPIC_API_KEY removed from INTEGRATIONS.md env vars. No production code imports anthropic SDK. Historical planning docs preserved. config.yaml "anthropic" tech keyword preserved. Requirement CFG-02 complete.
  </done>
</task>

</tasks>

<verification>
1. `uv run ruff check .` -- zero lint errors
2. `uv run pytest tests/ -x --timeout=30` -- full suite passes
3. Grep for `Anthropic SDK` across CLAUDE.md, architecture.md, INTEGRATIONS.md, PROJECT.md -- zero results
4. Grep for `ANTHROPIC_API_KEY` across same files -- zero results
5. Grep for `import anthropic` across all .py files -- zero results in production code
6. Grep for `Claude CLI` in CLAUDE.md and architecture.md -- at least 1 result each
7. config.yaml still contains "anthropic" in tech_keywords (not removed)
</verification>

<success_criteria>
- All 4 documentation files accurately reference Claude CLI instead of Anthropic SDK
- ANTHROPIC_API_KEY removed from INTEGRATIONS.md required env vars
- No production Python code imports the anthropic package
- Historical planning docs (phases 1-18) are untouched
- config.yaml tech_keywords "anthropic" is preserved
- Requirement CFG-02 fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/19-cover-letter-via-cli-sse-cleanup/19-02-SUMMARY.md`
</output>
