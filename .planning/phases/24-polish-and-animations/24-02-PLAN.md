---
phase: 24-polish-and-animations
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - site/src/styles/global.css
  - site/src/layouts/BaseLayout.astro
  - site/src/components/sections/Features.astro
  - site/src/components/sections/TechStack.astro
  - site/src/components/sections/Architecture.astro
  - site/src/components/sections/CodeSnippets.astro
  - site/src/components/sections/Timeline.astro
  - site/src/components/sections/QuickStart.astro
autonomous: true

must_haves:
  truths:
    - "Sections below the fold fade in with a subtle upward slide when scrolled into view"
    - "Animations fire only once per section (not on every scroll pass)"
    - "Content is immediately visible if JavaScript is disabled or fails to load"
    - "Animations are disabled entirely when prefers-reduced-motion is set"
  artifacts:
    - path: "site/src/styles/global.css"
      provides: "CSS transitions for [data-animate] elements and prefers-reduced-motion override"
      contains: "data-animate"
    - path: "site/src/layouts/BaseLayout.astro"
      provides: "Script that adds .js-enabled class to html element for FOUC prevention"
      contains: "js-enabled"
  key_links:
    - from: "site/src/styles/global.css"
      to: "section[data-animate] elements"
      via: "CSS attribute selector applies opacity:0 + translateY only when .js-enabled present"
      pattern: "\\.js-enabled.*data-animate"
    - from: "site/src/layouts/BaseLayout.astro"
      to: "site/src/styles/global.css"
      via: "is:inline script adds .js-enabled class enabling animation styles"
      pattern: "js-enabled"
---

<objective>
Add scroll-triggered fade-in animations to content sections using IntersectionObserver and CSS transitions, with FOUC prevention and reduced motion support.

Purpose: PLSH-02 requires "scroll-triggered fade-in animations via IntersectionObserver + CSS transitions" so sections animate into view as the visitor scrolls, signaling craftsmanship without heavy libraries.

Output: Updated global.css with animation styles, updated BaseLayout.astro with .js-enabled gate, data-animate attributes on 6 section components, IntersectionObserver script
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-polish-and-animations/24-RESEARCH.md
@.planning/phases/24-polish-and-animations/24-01-SUMMARY.md

@site/src/styles/global.css
@site/src/layouts/BaseLayout.astro
@site/src/components/sections/Features.astro
@site/src/components/sections/TechStack.astro
@site/src/components/sections/Architecture.astro
@site/src/components/sections/CodeSnippets.astro
@site/src/components/sections/Timeline.astro
@site/src/components/sections/QuickStart.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Animation CSS styles + FOUC prevention in BaseLayout</name>
  <files>
    site/src/styles/global.css
    site/src/layouts/BaseLayout.astro
  </files>
  <action>
    **Update `site/src/styles/global.css`** -- append after the scroll-behavior rules added by Plan 01:

    ```css
    /* Scroll-triggered fade-in animations */
    .js-enabled [data-animate] {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }

    .js-enabled [data-animate].animate-in {
      opacity: 1;
      transform: translateY(0);
    }

    @media (prefers-reduced-motion: reduce) {
      .js-enabled [data-animate] {
        opacity: 1;
        transform: none;
        transition: none;
      }
    }
    ```

    Key design decisions:
    - The `.js-enabled` prefix means: if JS never runs, no `opacity: 0` is applied -- content is visible by default (FOUC prevention)
    - Only `opacity` and `transform` are animated (GPU-accelerated, no layout recalculation)
    - `prefers-reduced-motion` override makes content immediately visible with no transitions

    **Update `site/src/layouts/BaseLayout.astro`:**
    - In the existing `is:inline` script block (the FOUC-preventing theme script in `<head>`), add one line at the end:
      `document.documentElement.classList.add('js-enabled');`
    - This must be in the `is:inline` script so it runs before paint, preventing flash of unanimated content
    - The existing theme script already runs synchronously before paint -- adding this line there is the cleanest approach

    Example -- the existing script becomes:
    ```javascript
    ;(function() {
      const stored = localStorage.getItem('theme');
      const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored === 'dark' || stored === 'light'
        ? stored
        : (systemDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.style.colorScheme = theme;
      document.documentElement.classList.add('js-enabled');
    })();
    ```
  </action>
  <verify>
    Run `cd /Users/patrykattc/work/jobs/site && npm run build` -- must succeed.
    Verify global.css contains `.js-enabled [data-animate]` rule with opacity: 0 and translateY(20px).
    Verify global.css contains `.js-enabled [data-animate].animate-in` rule with opacity: 1.
    Verify global.css contains `@media (prefers-reduced-motion: reduce)` block for `.js-enabled [data-animate]`.
    Verify BaseLayout.astro's is:inline script adds `js-enabled` class to documentElement.
  </verify>
  <done>
    CSS animation styles exist gated behind .js-enabled class. Without JS, elements are fully visible (opacity: 1 default). With JS, elements start invisible and animate in when .animate-in class is added. Reduced motion users see no animations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add data-animate to sections + IntersectionObserver script</name>
  <files>
    site/src/components/sections/Features.astro
    site/src/components/sections/TechStack.astro
    site/src/components/sections/Architecture.astro
    site/src/components/sections/CodeSnippets.astro
    site/src/components/sections/Timeline.astro
    site/src/components/sections/QuickStart.astro
  </files>
  <action>
    **Add `data-animate` attribute to 6 section components:**

    Only sections BELOW the fold get animations. Hero and Stats are above the fold and should NOT animate (they're immediately visible on page load). Footer is a landmark, not content -- no animation.

    For each of these 6 files, add `data-animate` to the root `<section>` element:

    1. `Features.astro`: `<section id="features" data-animate class="py-20 ...`
    2. `TechStack.astro`: `<section id="tech-stack" data-animate class="py-20 ...`
    3. `Architecture.astro`: `<section id="architecture" data-animate class="py-20 ...`
    4. `CodeSnippets.astro`: `<section id="code" data-animate class="py-20 ...`
    5. `Timeline.astro`: `<section id="timeline" data-animate class="py-20 ...`
    6. `QuickStart.astro`: `<section id="quickstart" data-animate class="py-20 ...`

    Just add the `data-animate` attribute -- the CSS does the rest.

    **Add IntersectionObserver script:**

    Add a `<script>` tag to one of the section files (Features.astro is a good choice since it's the first animated section) OR create the script inline in index.astro. The best approach is a `<script>` tag in the last modified section file (QuickStart.astro) since Astro deduplicates component scripts -- it will run once regardless of which component contains it. However, the cleanest approach is to add it to `site/src/layouts/BaseLayout.astro` as a non-inline script tag just before `</body>`:

    Actually, the cleanest location is inside one of the section components (Astro processes it once). Add to `Features.astro` since it's the first animated section:

    ```javascript
    <script>
    function initScrollAnimations() {
      const prefersReducedMotion = window.matchMedia(
        '(prefers-reduced-motion: reduce)'
      ).matches;
      if (prefersReducedMotion) return;

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate-in');
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
      );

      document.querySelectorAll('[data-animate]').forEach((el) => {
        observer.observe(el);
      });
    }

    initScrollAnimations();
    document.addEventListener('astro:page-load', initScrollAnimations);
    </script>
    ```

    Key details:
    - `threshold: 0.1` means 10% of the section must be visible before animating
    - `rootMargin: '0px 0px -50px 0px'` means the trigger point is 50px above the bottom edge of the viewport, so animations start slightly before the section is fully scrolled to
    - `observer.unobserve(entry.target)` ensures fire-once behavior
    - `astro:page-load` handles ClientRouter soft navigation re-initialization
    - `prefers-reduced-motion` check exits early -- no observer created, no classes toggled, content stays visible via CSS defaults
  </action>
  <verify>
    Run `cd /Users/patrykattc/work/jobs/site && npm run build` -- must succeed.
    Verify each of the 6 section files has `data-animate` on its root `<section>` tag.
    Verify Hero.astro and Stats.astro do NOT have `data-animate` (above the fold).
    Verify Footer.astro does NOT have `data-animate`.
    Verify Features.astro contains the IntersectionObserver script with observer.unobserve, prefers-reduced-motion check, and astro:page-load listener.
  </verify>
  <done>
    Six content sections (Features, TechStack, Architecture, CodeSnippets, Timeline, QuickStart) fade in with a subtle upward slide when scrolled into view. Animations fire once per section. Content is immediately visible without JS. Reduced motion users see no animations.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/patrykattc/work/jobs/site && npm run build` succeeds with zero errors
2. global.css contains .js-enabled [data-animate] styles with opacity/transform transitions
3. global.css contains @media (prefers-reduced-motion: reduce) override
4. BaseLayout.astro is:inline script adds 'js-enabled' class to html element
5. 6 section components have data-animate attribute on root element
6. Hero, Stats, and Footer do NOT have data-animate
7. IntersectionObserver script exists with fire-once behavior and reduced motion check
</verification>

<success_criteria>
- Sections below the fold fade in with upward slide when scrolled into view
- Animations fire once per section (not on every scroll)
- Content visible immediately if JavaScript is disabled (no FOUC)
- Animations fully disabled when prefers-reduced-motion is active
- Build succeeds with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-polish-and-animations/24-02-SUMMARY.md`
</output>
