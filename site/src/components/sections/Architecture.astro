---
const phases = [
  { step: 1, name: "Setup", description: "Config & credentials", icon: "gear" },
  { step: 2, name: "Login", description: "Platform auth", icon: "key" },
  { step: 3, name: "Search", description: "Job discovery", icon: "search" },
  { step: 4, name: "Score", description: "AI match scoring", icon: "brain" },
  { step: 5, name: "Apply", description: "One-click submit", icon: "send" },
];

const iconPaths: Record<string, string> = {
  gear: "M12 15a3 3 0 100-6 3 3 0 000 6z M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z",
  key: "M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4",
  search: "M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",
  brain: "M12 2a9 9 0 019 9c0 3.87-3.13 7-7 7h-4c-3.87 0-7-3.13-7-7a9 9 0 019-9zm-1 4v2m2-2v2m-4 3h6m-5 3h4",
  send: "M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",
};
---

<section id="architecture" data-animate class="py-20 bg-white">
  <div class="max-w-6xl mx-auto px-4">
    <h2 class="font-display text-3xl font-bold text-surface-900 text-center">
      How It Works
    </h2>
    <p class="mt-3 text-surface-600 text-center max-w-2xl mx-auto">
      A five-phase pipeline from configuration to application
    </p>

    {/* Desktop: horizontal pipeline with animated arrows */}
    <div class="mt-14 hidden md:block" id="pipeline-desktop">
      <div class="flex items-start justify-between relative">
        {phases.map((phase, i) => (
          <>
            <div class="flex-1 flex flex-col items-center text-center pipeline-phase"
                 style={`--phase-delay: ${i * 200}ms`}>
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-400 to-primary-600
                          text-white flex items-center justify-center shadow-lg shadow-primary-600/20
                          hover:shadow-xl hover:shadow-primary-500/30 hover:-translate-y-1 transition-all duration-300">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d={iconPaths[phase.icon]} />
                </svg>
              </div>
              <div class="mt-3 w-7 h-7 rounded-full bg-accent-500 text-surface-950
                          flex items-center justify-center font-display text-xs font-bold">
                {phase.step}
              </div>
              <h3 class="mt-2 font-display font-semibold text-surface-900">
                {phase.name}
              </h3>
              <p class="mt-1 text-sm text-surface-500">
                {phase.description}
              </p>
            </div>
            {i < phases.length - 1 && (
              <div class="flex items-center pt-8 shrink-0 px-1">
                <svg width="40" height="16" viewBox="0 0 40 16" class="pipeline-arrow text-primary-400">
                  <line x1="0" y1="8" x2="32" y2="8" stroke="currentColor" stroke-width="2"
                        stroke-dasharray="32" stroke-dashoffset="32" class="arrow-line" />
                  <polygon points="30,3 38,8 30,13" fill="currentColor" opacity="0" class="arrow-head" />
                </svg>
              </div>
            )}
          </>
        ))}
      </div>
    </div>

    {/* Mobile: vertical pipeline with connecting line */}
    <div class="mt-12 md:hidden">
      <div class="relative ml-6 border-l-2 border-primary-200 space-y-8">
        {phases.map((phase) => (
          <div class="relative pl-8">
            <div class="absolute -left-5 top-0 w-10 h-10 rounded-xl bg-gradient-to-br from-primary-400 to-primary-600
                        text-white flex items-center justify-center shadow-md">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d={iconPaths[phase.icon]} />
              </svg>
            </div>
            <div class="pt-1">
              <div class="flex items-center gap-2">
                <span class="w-5 h-5 rounded-full bg-accent-500 text-surface-950
                             flex items-center justify-center font-display text-[10px] font-bold">
                  {phase.step}
                </span>
                <h3 class="font-display font-semibold text-surface-900">
                  {phase.name}
                </h3>
              </div>
              <p class="mt-1 text-sm text-surface-500">
                {phase.description}
              </p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  .pipeline-phase {
    opacity: 0;
    transform: translateY(16px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    transition-delay: var(--phase-delay, 0ms);
  }

  .animate-in .pipeline-phase {
    opacity: 1;
    transform: translateY(0);
  }

  .arrow-line {
    transition: stroke-dashoffset 0.6s ease-out;
  }

  .arrow-head {
    transition: opacity 0.3s ease-out;
  }

  .animate-in .arrow-line {
    stroke-dashoffset: 0;
  }

  .animate-in .arrow-head {
    opacity: 1;
  }

  .animate-in .pipeline-arrow:nth-of-type(1) .arrow-line { transition-delay: 300ms; }
  .animate-in .pipeline-arrow:nth-of-type(1) .arrow-head { transition-delay: 600ms; }
  .animate-in .pipeline-arrow:nth-of-type(2) .arrow-line { transition-delay: 500ms; }
  .animate-in .pipeline-arrow:nth-of-type(2) .arrow-head { transition-delay: 800ms; }
  .animate-in .pipeline-arrow:nth-of-type(3) .arrow-line { transition-delay: 700ms; }
  .animate-in .pipeline-arrow:nth-of-type(3) .arrow-head { transition-delay: 1000ms; }
  .animate-in .pipeline-arrow:nth-of-type(4) .arrow-line { transition-delay: 900ms; }
  .animate-in .pipeline-arrow:nth-of-type(4) .arrow-head { transition-delay: 1200ms; }

  @media (prefers-reduced-motion: reduce) {
    .pipeline-phase {
      opacity: 1;
      transform: none;
      transition: none;
    }
    .arrow-line {
      stroke-dashoffset: 0 !important;
      transition: none;
    }
    .arrow-head {
      opacity: 1 !important;
      transition: none;
    }
  }
</style>
